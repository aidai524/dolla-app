import clsx from "clsx";
import { motion } from "framer-motion";
import Market from "./market";
import MoreMarketBtn from "./btn";
import MarketLoading from "./market-loading";
import usePoolList from "@/hooks/use-pool-list";
import { useBtcContext } from "../../context";

export default function Markets({ onClose }: { onClose: () => void }) {
  const {
    poolList,
    loading,
    onQueryPoolList,
    sortField,
    setSortField,
    sortOrder,
    setSortOrder,
    hasMore,
    pageRef,
    volume,
    setVolume,
    LIMIT
  } = usePoolList();
  const { setSelectedMarket } = useBtcContext();

  return (
    <motion.div
      className="fixed top-0 left-0 w-full z-[50]"
      initial={{ y: "-100%" }}
      animate={{ y: 0 }}
      exit={{ y: "-100%" }}
      transition={{
        type: "spring",
        stiffness: 300,
        damping: 30,
        duration: 0.5
      }}
    >
      <div className="bg-[#1A1E24] border-b border-[#3C3420]">
        <div className="relative z-[2]">
          <div className="p-[20px] pb-[0px] flex items-center justify-between">
            <div className="flex items-center gap-[8px]">
              <img
                src="/logo.svg"
                alt="dolla"
                className="w-[101px] h-[30px] mt-[-6px]"
              />
              <span className="text-[#9CBBFC] text-[30px] font-[BlackHanSans]">
                Markets
              </span>
            </div>
            <div className="flex items-center gap-[46px] text-[#ADBCCF] text-[12px]">
              <div className="flex items-center gap-[8px]">
                <div className="mr-[5px]">Prize Size</div>
                {[
                  { label: "ALL", key: 0 },
                  { label: "1 BTC", key: 1 },
                  { label: "0.1 BTC", key: 0.1 },
                  { label: "0.01 BTC", key: 0.001 }
                ].map((item: { label: string; key: number }) => (
                  <button
                    key={item.key}
                    className={clsx(
                      "button px-[12px] py-[9px] border border-[#383F47] rounded-[6px] w-min-[54px]",
                      volume === item.key
                        ? "bg-[#FFC42F] text-black"
                        : "bg-[#1A1E24]"
                    )}
                    onClick={() => setVolume(item.key)}
                  >
                    {item.label}
                  </button>
                ))}
              </div>
              <div className="flex items-center gap-[8px]">
                <div className="mr-[5px]">
                  <button
                    className="button"
                    onClick={() => {
                      setSortOrder(sortOrder === "desc" ? "asc" : "desc");
                    }}
                  >
                    {sortOrder === "asc" ? (
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="14"
                        height="13"
                        viewBox="0 0 14 13"
                        fill="none"
                      >
                        <path
                          d="M11.4211 9.31654C11.5188 9.31654 11.6125 9.27773 11.6816 9.20865C11.7507 9.13957 11.7895 9.04588 11.7895 8.94819V2.25497L12.8502 3.31507C12.9192 3.38412 13.0129 3.42291 13.1106 3.42291C13.2083 3.42291 13.302 3.38412 13.3711 3.31507L13.8921 2.79422C13.9611 2.72515 13.9999 2.63148 13.9999 2.5338C13.9999 2.43613 13.9611 2.34246 13.8921 2.27338L11.8878 0.269579C11.7627 0.144473 11.6041 0.0580788 11.4311 0.0207367C11.258 -0.0166063 11.0779 -0.00331593 10.9123 0.0590162C10.7466 0.121348 10.6024 0.230082 10.497 0.372206C10.3915 0.51433 10.3293 0.683824 10.3176 0.860406L10.3158 0.920815V8.94819C10.3158 9.04588 10.3546 9.13957 10.4237 9.20865C10.4928 9.27773 10.5865 9.31654 10.6842 9.31654H11.4211ZM7.73684 1.94961C7.78522 1.94961 7.83313 1.94008 7.87783 1.92157C7.92253 1.90306 7.96314 1.87592 7.99736 1.84172C8.03157 1.80752 8.05871 1.76691 8.07722 1.72222C8.09573 1.67753 8.10526 1.62963 8.10526 1.58126V0.844568C8.10526 0.796196 8.09573 0.748297 8.07722 0.703608C8.05871 0.658917 8.03157 0.618311 7.99736 0.584107C7.96314 0.549903 7.92253 0.52277 7.87783 0.504259C7.83313 0.485747 7.78522 0.476221 7.73684 0.476221H0.368421C0.320039 0.476221 0.272131 0.485747 0.227433 0.504259C0.182734 0.52277 0.142119 0.549903 0.107908 0.584107C0.073697 0.618311 0.0465594 0.658917 0.0280445 0.703608C0.00952959 0.748297 -2.26789e-09 0.796196 0 0.844568V1.58126C-2.26789e-09 1.62963 0.00952959 1.67753 0.0280445 1.72222C0.0465594 1.76691 0.073697 1.80752 0.107908 1.84172C0.142119 1.87592 0.182734 1.90306 0.227433 1.92157C0.272131 1.94008 0.320039 1.94961 0.368421 1.94961H7.73684ZM7.73684 7.4748C7.78522 7.4748 7.83313 7.46528 7.87783 7.44676C7.92253 7.42825 7.96314 7.40112 7.99736 7.36692C8.03157 7.33271 8.05871 7.29211 8.07722 7.24742C8.09573 7.20273 8.10526 7.15483 8.10526 7.10646V6.36976C8.10526 6.32139 8.09573 6.27349 8.07722 6.2288C8.05871 6.18411 8.03157 6.14351 7.99736 6.1093C7.96314 6.0751 7.92253 6.04797 7.87783 6.02946C7.83313 6.01094 7.78522 6.00142 7.73684 6.00142H0.368421C0.320039 6.00142 0.272131 6.01094 0.227433 6.02946C0.182734 6.04797 0.142119 6.0751 0.107908 6.1093C0.073697 6.14351 0.0465594 6.18411 0.0280445 6.2288C0.00952959 6.27349 -2.26789e-09 6.32139 0 6.36976V7.10646C-2.26789e-09 7.15483 0.00952959 7.20273 0.0280445 7.24742C0.0465594 7.29211 0.073697 7.33271 0.107908 7.36692C0.142119 7.40112 0.182734 7.42825 0.227433 7.44676C0.272131 7.46528 0.320039 7.4748 0.368421 7.4748H7.73684ZM13.6316 13C13.68 13 13.7279 12.9905 13.7726 12.972C13.8173 12.9535 13.8579 12.9263 13.8921 12.8921C13.9263 12.8579 13.9534 12.8173 13.972 12.7726C13.9905 12.7279 14 12.68 14 12.6317V11.895C14 11.8466 13.9905 11.7987 13.972 11.754C13.9534 11.7093 13.9263 11.6687 13.8921 11.6345C13.8579 11.6003 13.8173 11.5732 13.7726 11.5547C13.7279 11.5361 13.68 11.5266 13.6316 11.5266H0.368421C0.320039 11.5266 0.272131 11.5361 0.227433 11.5547C0.182734 11.5732 0.142119 11.6003 0.107908 11.6345C0.073697 11.6687 0.0465594 11.7093 0.0280445 11.754C0.00952959 11.7987 -2.26789e-09 11.8466 0 11.895V12.6317C-2.26789e-09 12.68 0.00952959 12.7279 0.0280445 12.7726C0.0465594 12.8173 0.073697 12.8579 0.107908 12.8921C0.142119 12.9263 0.182734 12.9535 0.227433 12.972C0.272131 12.9905 0.320039 13 0.368421 13H13.6316Z"
                          fill="#ADBCCF"
                        />
                      </svg>
                    ) : (
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="14"
                        height="13"
                        viewBox="0 0 14 13"
                        fill="none"
                      >
                        <path
                          d="M11.4211 3.68346C11.5188 3.68346 11.6125 3.72227 11.6816 3.79135C11.7507 3.86043 11.7895 3.95412 11.7895 4.05181V10.745L12.8502 9.68493C12.9192 9.61588 13.0129 9.57709 13.1106 9.57709C13.2083 9.57709 13.302 9.61588 13.3711 9.68493L13.8921 10.2058C13.9611 10.2749 13.9999 10.3685 13.9999 10.4662C13.9999 10.5639 13.9611 10.6575 13.8921 10.7266L11.8878 12.7304C11.7627 12.8555 11.6041 12.9419 11.4311 12.9793C11.258 13.0166 11.0779 13.0033 10.9123 12.941C10.7466 12.8787 10.6024 12.7699 10.497 12.6278C10.3915 12.4857 10.3293 12.3162 10.3176 12.1396L10.3158 12.0792V4.05181C10.3158 3.95412 10.3546 3.86043 10.4237 3.79135C10.4928 3.72227 10.5865 3.68346 10.6842 3.68346H11.4211ZM7.73684 11.0504C7.78522 11.0504 7.83313 11.0599 7.87783 11.0784C7.92253 11.0969 7.96314 11.1241 7.99736 11.1583C8.03157 11.1925 8.0587 11.2331 8.07722 11.2778C8.09573 11.3225 8.10526 11.3704 8.10526 11.4187V12.1554C8.10526 12.2038 8.09573 12.2517 8.07722 12.2964C8.0587 12.3411 8.03157 12.3817 7.99736 12.4159C7.96314 12.4501 7.92253 12.4772 7.87783 12.4957C7.83313 12.5143 7.78522 12.5238 7.73684 12.5238H0.368421C0.320039 12.5238 0.272131 12.5143 0.227433 12.4957C0.182734 12.4772 0.142119 12.4501 0.107908 12.4159C0.073697 12.3817 0.0465594 12.3411 0.0280445 12.2964C0.00952959 12.2517 -2.26789e-09 12.2038 0 12.1554V11.4187C-2.26789e-09 11.3704 0.00952959 11.3225 0.0280445 11.2778C0.0465594 11.2331 0.073697 11.1925 0.107908 11.1583C0.142119 11.1241 0.182734 11.0969 0.227433 11.0784C0.272131 11.0599 0.320039 11.0504 0.368421 11.0504H7.73684ZM7.73684 5.5252C7.78522 5.5252 7.83313 5.53472 7.87783 5.55324C7.92253 5.57175 7.96314 5.59888 7.99736 5.63308C8.03157 5.66729 8.0587 5.70789 8.07722 5.75258C8.09573 5.79727 8.10526 5.84517 8.10526 5.89354V6.63024C8.10526 6.67861 8.09573 6.72651 8.07722 6.7712C8.0587 6.81589 8.03157 6.85649 7.99736 6.8907C7.96314 6.9249 7.92253 6.95203 7.87783 6.97054C7.83313 6.98906 7.78522 6.99858 7.73684 6.99858H0.368421C0.320039 6.99858 0.272131 6.98906 0.227433 6.97054C0.182734 6.95203 0.142119 6.9249 0.107908 6.8907C0.073697 6.85649 0.0465594 6.81589 0.0280445 6.7712C0.00952959 6.72651 -2.26789e-09 6.67861 0 6.63024V5.89354C-2.26789e-09 5.84517 0.00952959 5.79727 0.0280445 5.75258C0.0465594 5.70789 0.073697 5.66729 0.107908 5.63308C0.142119 5.59888 0.182734 5.57175 0.227433 5.55324C0.272131 5.53472 0.320039 5.5252 0.368421 5.5252H7.73684ZM13.6316 0C13.68 0 13.7279 0.00952753 13.7726 0.0280387C13.8173 0.0465498 13.8579 0.0736822 13.8921 0.107886C13.9263 0.14209 13.9534 0.182696 13.972 0.227386C13.9905 0.272076 14 0.319975 14 0.368347V1.10504C14 1.15341 13.9905 1.20131 13.972 1.246C13.9534 1.29069 13.9263 1.3313 13.8921 1.3655C13.8579 1.3997 13.8173 1.42684 13.7726 1.44535C13.7279 1.46386 13.68 1.47339 13.6316 1.47339H0.368421C0.320039 1.47339 0.272131 1.46386 0.227433 1.44535C0.182734 1.42684 0.142119 1.3997 0.107908 1.3655C0.073697 1.3313 0.0465594 1.29069 0.0280445 1.246C0.00952959 1.20131 -2.26789e-09 1.15341 0 1.10504V0.368347C-2.26789e-09 0.319975 0.00952959 0.272076 0.0280445 0.227386C0.0465594 0.182696 0.073697 0.14209 0.107908 0.107886C0.142119 0.0736822 0.182734 0.0465498 0.227433 0.0280387C0.272131 0.00952753 0.320039 0 0.368421 0H13.6316Z"
                          fill="#ADBCCF"
                        />
                      </svg>
                    )}
                  </button>
                </div>
                {[
                  { label: "Hitting", key: "hitting" },
                  { label: "Players", key: "participants" },
                  { label: "Time", key: "time" }
                ].map((item: { label: string; key: string }) => (
                  <button
                    key={item.key}
                    className={clsx(
                      "button px-[12px] py-[9px] border border-[#383F47] rounded-[6px] w-min-[54px]",
                      sortField === item.key
                        ? "bg-[#FFC42F] text-black"
                        : "bg-[#1A1E24]"
                    )}
                    onClick={() => setSortField(item.key)}
                  >
                    {item.label}
                  </button>
                ))}
              </div>
            </div>
          </div>
          <div className="flex items-center justify-center gap-[20px] py-[50px] px-[20px]">
            {poolList.map((item: any) => (
              <Market
                key={item.id}
                data={item}
                onClick={() => setSelectedMarket(item)}
              />
            ))}
            {loading && (
              <>
                {Array.from({ length: LIMIT }).map((_, index) => (
                  <MarketLoading key={index} />
                ))}
              </>
            )}
            {!loading && poolList.length === 0 && (
              <div className="text-center text-[#ADBCCF] leading-[168px]">
                No data
              </div>
            )}
            <NextBtn
              onClick={() => {
                onQueryPoolList(-1);
              }}
              className={clsx(
                "absolute left-0 bottom-[-20px] rotate-180",
                pageRef.current !== 0 ? "button" : "opacity-50"
              )}
            />
            <NextBtn
              onClick={() => {
                onQueryPoolList(1);
              }}
              className={clsx(
                "absolute right-0 bottom-[-20px]",
                hasMore ? "button" : "opacity-50"
              )}
            />
          </div>
        </div>
        <MoreMarketBtn
          className="absolute left-[50%] translate-x-[-50%] bottom-[-54px]"
          onClick={onClose}
        />
      </div>
    </motion.div>
  );
}

const NextBtn = ({
  onClick,
  className
}: {
  onClick: () => void;
  className?: string;
}) => {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="51"
      height="51"
      viewBox="0 0 51 51"
      fill="none"
      onClick={onClick}
      className={className}
    >
      <rect width="51" height="51" rx="10" fill="#FFC42F" />
      <path
        d="M35.9263 22.3396C37.9905 23.941 37.9905 27.059 35.9263 28.6604L22.4519 39.1141C19.8237 41.153 16 39.28 16 35.9537L16 15.0463C16 11.72 19.8238 9.84698 22.4519 11.8859L35.9263 22.3396Z"
        fill="#2B3337"
        stroke="#FFF79E"
      />
    </svg>
  );
};
